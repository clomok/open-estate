{% extends 'base.html' %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Assets & Liabilities</h1>
    <a href="{{ url_for('manage.select_type') }}" 
       style="background: var(--primary); color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 4px; display: inline-block;">
        + Add Item
    </a>
</div>

<h2 style="margin-bottom: 1rem; font-size: 1.25rem; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem;">Assets</h2>

{% if assets %}
<div class="asset-grid">
    {% for asset in assets %}
    <div class="asset-card">
        <div class="action-menu">
            <button class="menu-btn" onclick="toggleDropdown(event, 'menu-{{ asset.id }}')">
                &#8942; </button>
            <div id="menu-{{ asset.id }}" class="menu-dropdown">
                <a href="{{ url_for('main.asset_details', id=asset.id) }}" class="menu-item">View Details</a>
                <a href="{{ url_for('manage.manage_asset', id=asset.id) }}" class="menu-item">Edit</a>
                <a href="{{ url_for('manage.delete_asset', id=asset.id) }}" 
                   class="menu-item danger"
                   onclick="return confirm('Are you sure you want to delete this asset?');">Delete</a>
            </div>
        </div>

        <div style="padding-right: 2rem;"> <div style="font-size: 0.8rem; color: #6b7280; text-transform: uppercase; margin-bottom: 0.25rem;">
                {{ asset.asset_type }}
            </div>
            <a href="{{ url_for('main.asset_details', id=asset.id) }}" style="text-decoration: none; color: inherit;">
                <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem; color: var(--primary);">{{ asset.name }}</h3>
            </a>
            
            <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">
                ${{ "{:,.0f}".format(asset.value_estimated) }}
            </div>

            <div>
                {% if asset.is_in_trust %}
                    <span class="asset-badge badge-trust">Held in Trust</span>
                {% elif asset.owner %}
                    <span class="asset-badge" style="background: #f3f4f6; color: #374151;">{{ asset.owner.name }}</span>
                {% endif %}
            </div>

            {% if asset.attributes %}
            <div style="margin-top: 0.75rem; font-size: 0.85rem; color: #6b7280; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                {% if asset.attributes.get('vin') %}VIN: {{ asset.attributes.vin }}{% endif %}
                {% if asset.attributes.get('account_number') %}Acct: ...{{ asset.attributes.account_number[-4:] }}{% endif %}
                {% if asset.attributes.get('address') %}{{ asset.attributes.address }}{% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="color: #666; margin-bottom: 2rem; font-style: italic;">No assets recorded yet.</p>
{% endif %}


<h2 style="margin-bottom: 1rem; font-size: 1.25rem; color: #b45309; border-bottom: 2px solid #fcd34d; padding-bottom: 0.5rem;">Liabilities</h2>

{% if liabilities %}
<div class="asset-grid">
    {% for asset in liabilities %}
    <div class="asset-card" style="border-left: 4px solid #ef4444;">
        <div class="action-menu">
            <button class="menu-btn" onclick="toggleDropdown(event, 'menu-{{ asset.id }}')">
                &#8942;
            </button>
            <div id="menu-{{ asset.id }}" class="menu-dropdown">
                <a href="{{ url_for('main.asset_details', id=asset.id) }}" class="menu-item">View Details</a>
                <a href="{{ url_for('manage.manage_asset', id=asset.id) }}" class="menu-item">Edit</a>
                <a href="{{ url_for('manage.delete_asset', id=asset.id) }}" 
                   class="menu-item danger"
                   onclick="return confirm('Delete this liability?');">Delete</a>
            </div>
        </div>

        <div style="padding-right: 2rem;">
            <div style="font-size: 0.8rem; color: #b45309; text-transform: uppercase; margin-bottom: 0.25rem;">
                {{ asset.asset_type }}
            </div>
            <a href="{{ url_for('main.asset_details', id=asset.id) }}" style="text-decoration: none; color: inherit;">
                <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem; color: #b45309;">{{ asset.name }}</h3>
            </a>
            
            <div style="font-size: 1.5rem; font-weight: bold; color: #ef4444; margin-bottom: 0.5rem;">
                ${{ "{:,.0f}".format(asset.value_estimated) }}
            </div>

            <div>
                {% if asset.owner %}
                    <span class="asset-badge" style="background: #f3f4f6; color: #374151;">{{ asset.owner.name }}</span>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="color: #666; margin-bottom: 2rem; font-style: italic;">No liabilities recorded.</p>
{% endif %}

<script>
    function toggleDropdown(event, menuId) {
        event.stopPropagation(); // Prevent document click from closing it immediately
        
        // 1. Close all other open menus first
        document.querySelectorAll('.menu-dropdown').forEach(menu => {
            if (menu.id !== menuId) {
                menu.classList.remove('show');
            }
        });

        // 2. Toggle the requested menu
        const menu = document.getElementById(menuId);
        if (menu) {
            menu.classList.toggle('show');
        }
    }

    // Close menu when clicking anywhere else
    document.addEventListener('click', function() {
        document.querySelectorAll('.menu-dropdown').forEach(menu => {
            menu.classList.remove('show');
        });
    });
</script>
{% endblock %}